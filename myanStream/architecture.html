<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>myanStream å°ˆæ¡ˆæ¶æ§‹åœ–</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@9.4.3/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        h1 {
            color: #2d3748;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }

        .subtitle {
            color: #718096;
            font-size: 1.2rem;
            margin-bottom: 20px;
        }

        .back-button {
            display: inline-block;
            padding: 10px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .back-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .tech-stack {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 40px;
            text-align: center;
        }

        .tech-stack h3 {
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .tech-badges {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .tech-badge {
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.95rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.3);
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 25px;
            background: #e2e8f0;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            color: #2d3748;
        }

        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .tab:hover:not(.active) {
            background: #cbd5e0;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .diagram-section {
            background: #f7fafc;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
        }

        .diagram-section h2 {
            color: #2d3748;
            margin-bottom: 20px;
            font-size: 1.8rem;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .diagram-section h3 {
            color: #4a5568;
            margin-top: 25px;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .mermaid {
            background: white;
            padding: 30px;
            border-radius: 8px;
            margin: 20px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow-x: auto;
            text-align: center;
        }

        pre.mermaid {
            background: white;
            font-family: inherit;
        }

        .info-box {
            background: #edf2f7;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }

        .info-box h4 {
            color: #2d3748;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .info-box ul {
            margin-left: 20px;
            color: #4a5568;
            line-height: 1.8;
        }

        .info-box code {
            background: #cbd5e0;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .warning-box {
            background: #fff5f5;
            border-left: 4px solid #f56565;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }

        .warning-box h4 {
            color: #c53030;
            margin-bottom: 10px;
        }

        .success-box {
            background: #f0fff4;
            border-left: 4px solid #48bb78;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }

        .success-box h4 {
            color: #2f855a;
            margin-bottom: 10px;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .feature-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 16px rgba(102, 126, 234, 0.3);
        }

        .feature-card h4 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .feature-card p {
            color: #4a5568;
            line-height: 1.6;
        }

        .feature-card ul {
            margin-left: 20px;
            margin-top: 10px;
            color: #4a5568;
            line-height: 1.6;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid #e2e8f0;
            color: #4a5568;
        }

        tr:last-child td {
            border-bottom: none;
        }

        tr:hover {
            background: #f7fafc;
        }

        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            line-height: 1.6;
        }

        .highlight {
            background: #fef5e7;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
            color: #d97706;
        }

        .comparison-table {
            margin: 20px 0;
        }

        .comparison-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .pros {
            color: #2f855a;
            font-weight: 600;
        }

        .cons {
            color: #c53030;
            font-weight: 600;
        }

        footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 2px solid #e2e8f0;
            color: #718096;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 2rem;
            }

            .tabs {
                flex-direction: column;
            }

            .tab {
                width: 100%;
            }

            .feature-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-button">â† è¿”å›é¦–é </a>

        <div class="header">
            <h1>ğŸ“¡ myanStream æ¶æ§‹è¨­è¨ˆ</h1>
            <p class="subtitle">å¤šå¹³å°ç›´æ’­ä¸²æµè½‰æ¨ç³»çµ± - å®Œæ•´æŠ€è¡“æ¶æ§‹æ–‡ä»¶</p>
        </div>

        <div class="tech-stack">
            <h3>ğŸ› ï¸ æ ¸å¿ƒæŠ€è¡“æ£§</h3>
            <div class="tech-badges">
                <span class="tech-badge">SRS (RTMP Server)</span>
                <span class="tech-badge">FFmpeg</span>
                <span class="tech-badge">Laravel Octane</span>
                <span class="tech-badge">Docker</span>
                <span class="tech-badge">AWS ECS (é¸é…)</span>
                <span class="tech-badge">WebSocket</span>
                <span class="tech-badge">MySQL</span>
                <span class="tech-badge">Redis</span>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('overview', this)">ç³»çµ±ç¸½è¦½</button>
            <button class="tab" onclick="showTab('docker', this)">è‡ªæ¶ Docker</button>
            <button class="tab" onclick="showTab('ecs', this)">AWS ECS</button>
            <button class="tab" onclick="showTab('flow', this)">å®Œæ•´æµç¨‹</button>
            <button class="tab" onclick="showTab('database', this)">è³‡æ–™åº«è¨­è¨ˆ</button>
            <button class="tab" onclick="showTab('comparison', this)">æ–¹æ¡ˆæ¯”è¼ƒ</button>
        </div>

        <!-- ç³»çµ±ç¸½è¦½ Tab -->
        <div id="overview" class="tab-content active">
            <div class="diagram-section">
                <h2>ğŸ¯ ç³»çµ±æ¶æ§‹ç¸½è¦½</h2>

                <div class="info-box">
                    <h4>ğŸ’¡ æ ¸å¿ƒæ¦‚å¿µ</h4>
                    <ul>
                        <li><strong>ä¸€æ¨å¤šç™¼ï¼š</strong>ä½¿ç”¨è€…åªéœ€æ¨ä¸€è·¯æµåˆ° SRSï¼Œç³»çµ±è‡ªå‹•è½‰æ¨åˆ° YouTubeã€Facebookã€Instagram</li>
                        <li><strong>è·è²¬åˆ†é›¢ï¼š</strong>SRS è™•ç†åª’é«”æµï¼ŒLaravel è™•ç†æ¥­å‹™é‚è¼¯ï¼ŒFFmpeg è² è²¬è½‰æ¨</li>
                        <li><strong>æŒ‰éœ€æ“´å……ï¼š</strong>FFmpeg æŒ‰éœ€å•Ÿå‹•ï¼Œæ¯å ´ç›´æ’­ä¸€å€‹åŸ·è¡Œå€‹é«”</li>
                        <li><strong>çµ±ä¸€èŠå¤©ï¼š</strong>æ•´åˆä¸‰å€‹å¹³å°çš„èŠå¤©å®¤ï¼Œé€é WebSocket æ¨é€çµ¦ App</li>
                    </ul>
                </div>

                <pre class="mermaid">
graph LR
    A[ä½¿ç”¨è€… App] -->|1. å»ºç«‹ç›´æ’­| B[Laravel API]
    B -->|2. å‘¼å«å¹³å° API| C[YouTube/Facebook/Instagram]
    A -->|3. æ¨ RTMP æµ| D[SRS ä¼ºæœå™¨]
    D -->|4. Webhook é€šçŸ¥| B
    B -->|5. å•Ÿå‹• FFmpeg| E[FFmpeg è½‰æ¨å¼•æ“]
    D -.->|6. æ‹‰æµ| E
    E -->|7. è½‰æ¨ RTMPS| C
    B -->|8. èŠå¤©æ•´åˆ| A
                </pre>

                <h3>ğŸ“Š æ ¸å¿ƒçµ„ä»¶è§’è‰²</h3>
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4>ğŸ“¡ SRS (åª’é«”ä¼ºæœå™¨)</h4>
                        <p><strong>è§’è‰²ï¼š</strong>åª’é«”äº¤æ›æ©Ÿ</p>
                        <ul>
                            <li>æ¥æ”¶ App çš„ RTMP æ¨æµ</li>
                            <li>è§¸ç™¼ Webhook é€šçŸ¥</li>
                            <li>æä¾›å…§ç¶²æ‹‰æµçµ¦ FFmpeg</li>
                        </ul>
                    </div>

                    <div class="feature-card">
                        <h4>ğŸ”§ Laravel (æ§åˆ¶ä¸­å¿ƒ)</h4>
                        <p><strong>è§’è‰²ï¼š</strong>æ¥­å‹™é‚è¼¯å±¤</p>
                        <ul>
                            <li>å‘¼å«å¹³å° API å»ºç«‹ç›´æ’­é–“</li>
                            <li>ç®¡ç† stream_key å°æ‡‰é—œä¿‚</li>
                            <li>å•Ÿå‹•/åœæ­¢ FFmpeg</li>
                            <li>æ¬Šé™æ§åˆ¶èˆ‡èŠå¤©æ•´åˆ</li>
                        </ul>
                    </div>

                    <div class="feature-card">
                        <h4>âš¡ FFmpeg (è½‰æ¨å¼•æ“)</h4>
                        <p><strong>è§’è‰²ï¼š</strong>åª’é«”æµè½‰æ¨å·¥å…·</p>
                        <ul>
                            <li>å¾ SRS æ‹‰å– RTMP æµ</li>
                            <li>è½‰æ¨åˆ°å„å¹³å° RTMPS</li>
                            <li>æ¯å ´ç›´æ’­ç¨ç«‹åŸ·è¡Œå€‹é«”</li>
                        </ul>
                    </div>
                </div>

                <div class="success-box">
                    <h4>âœ… æ¶æ§‹å„ªå‹¢</h4>
                    <ul>
                        <li><strong>ç¯€çœé »å¯¬ï¼š</strong>App åªéœ€ä¸Šå‚³ä¸€è·¯æµï¼Œç”±ä¼ºæœå™¨ç«¯è½‰æ¨åˆ°å¤šå€‹å¹³å°</li>
                        <li><strong>é«˜å¯ç”¨æ€§ï¼š</strong>çµ„ä»¶ç¨ç«‹éƒ¨ç½²ï¼Œå–®ä¸€å¹³å°å¤±æ•—ä¸å½±éŸ¿å…¶ä»–å¹³å°</li>
                        <li><strong>æ˜“æ“´å……ï¼š</strong>æ–°å¢ç¬¬å››ã€ç¬¬äº”å€‹å¹³å°åªéœ€ä¿®æ”¹è¨­å®š</li>
                        <li><strong>æˆæœ¬æœ€ä½³åŒ–ï¼š</strong>FFmpeg æŒ‰éœ€å•Ÿå‹•ï¼Œä½¿ç”¨å®Œå³åœæ­¢</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- è‡ªæ¶ Docker Tab -->
        <div id="docker" class="tab-content">
            <div class="diagram-section">
                <h2>ğŸ³ è‡ªæ¶ Docker ç‰ˆæœ¬æ¶æ§‹</h2>

                <div class="info-box">
                    <h4>ğŸ’° é©åˆå ´æ™¯</h4>
                    <ul>
                        <li><strong>åˆæœŸé–‹ç™¼/æ¸¬è©¦ï¼š</strong>æˆæœ¬è¼ƒä½ï¼Œå¿«é€Ÿé©—è­‰åŠŸèƒ½</li>
                        <li><strong>ä¸­å°è¦æ¨¡ï¼š</strong>åŒæ™‚åœ¨ç·šç›´æ’­æ•¸ < 50 å ´</li>
                        <li><strong>å›ºå®šæµé‡ï¼š</strong>ä¸éœ€è¦é »ç¹å½ˆæ€§æ“´å……</li>
                        <li><strong>è‡ªæœ‰ä¸»æ©Ÿï¼š</strong>å·²æœ‰ VPS æˆ–å¯¦é«”æ©Ÿå™¨</li>
                    </ul>
                </div>

                <h3>ğŸ—ï¸ éƒ¨ç½²æ¶æ§‹åœ–</h3>
                <pre class="mermaid">
graph TB
    subgraph client["ğŸ“± å®¢æˆ¶ç«¯"]
        A[ä½¿ç”¨è€… App]
    end

    subgraph docker["ğŸ³ Docker Compose ç’°å¢ƒ"]
        B[SRS å®¹å™¨<br/>Port: 1935, 1985]
        C[Laravel Octane<br/>Port: 8000]
        D[Queue Worker]
        E[FFmpeg å®¹å™¨ 1]
        F[FFmpeg å®¹å™¨ 2]
        I[(MySQL 8.0)]
        J[(Redis)]
    end

    subgraph platforms["ğŸŒ ç›´æ’­å¹³å°"]
        G[YouTube Live]
        H[Facebook Live]
    end

    A -->|RTMP æ¨æµ| B
    A -->|HTTP API| C
    B -.->|Webhook| C
    C --> D
    D -->|å•Ÿå‹•| E
    D -->|å•Ÿå‹•| F
    B -.->|æ‹‰æµ| E
    B -.->|æ‹‰æµ| F
    E -->|RTMPS| G
    F -->|RTMPS| H
    C --> I
    C --> J

    classDef clientStyle fill:#bbdefb,stroke:#1976d2,stroke-width:2px
    classDef containerStyle fill:#fff9c4,stroke:#f57c00,stroke-width:2px
    classDef workerStyle fill:#c8e6c9,stroke:#388e3c,stroke-width:2px
    classDef dbStyle fill:#e1bee7,stroke:#7b1fa2,stroke-width:2px
    classDef platformStyle fill:#ffccbc,stroke:#d84315,stroke-width:2px

    class A clientStyle
    class B,C containerStyle
    class D,E,F workerStyle
    class I,J dbStyle
    class G,H platformStyle
                </pre>

                <h3>ğŸ“‹ å¾ã€Œé–‹å§‹ç›´æ’­ã€åˆ°ã€ŒçµæŸã€çš„å®Œæ•´æµç¨‹</h3>

                <pre class="code-block">
<strong>Phase 1: ä½¿ç”¨è€…é»æ“Šã€Œé–‹å§‹ç›´æ’­ã€</strong>

1. App â†’ Laravel API
   POST /api/live/sessions

2. Laravel è™•ç†
   - å‘¼å« YouTube API å»ºç«‹ç›´æ’­é–“
   - å‘¼å« Facebook API å»ºç«‹ç›´æ’­é–“
   - ç”Ÿæˆå…§éƒ¨ stream_key: user123_abc456
   - å¯«å…¥è³‡æ–™åº«

3. å›å‚³çµ¦ App
   rtmp_url: rtmp://yourdomain.com/live/user123_abc456

<strong>Phase 2: App é–‹å§‹æ¨æµ</strong>

4. App æ¨æµåˆ° SRS

5. SRS è§¸ç™¼ on_publish Webhook

6. Laravel Webhook Handler
   - é©—è­‰ stream_key
   - dispatch(StartRestreamJob)
   - å›å‚³ 200 OK

<strong>Phase 3: Queue Worker å•Ÿå‹• FFmpeg</strong>

7. Queue Worker åŸ·è¡Œ StartRestreamJob
   - Redis Lock é˜²æ­¢ä¸¦ç™¼
   - å•Ÿå‹• FFmpeg å®¹å™¨

   docker run -d --name ffmpeg_session_123
     --network myanstream
     jrottenberg/ffmpeg:latest
     -re -i rtmp://srs:1935/live/user123_abc456
     -c:v copy -c:a copy
     -f flv rtmps://a.rtmp.youtube.com/live2/yt_key

<strong>Phase 4: ç›´æ’­é€²è¡Œä¸­</strong>

8. Monitor æ’ç¨‹ (æ¯ 30 ç§’)
   - æª¢æŸ¥ FFmpeg å®¹å™¨æ˜¯å¦å­˜æ´»
   - å¦‚æœç•°å¸¸ â†’ å˜—è©¦é‡å•Ÿ

9. èŠå¤©æ•´åˆ (WebSocket)
   - Laravel Job è¼ªè©¢å¹³å°èŠå¤© API
   - é€é WebSocket æ¨é€çµ¦ App

<strong>Phase 5: ç›´æ’­çµæŸ</strong>

10. App åœæ­¢æ¨æµ

11. SRS è§¸ç™¼ on_unpublish

12. Laravel è™•ç†çµæŸ
    - åœæ­¢ FFmpeg å®¹å™¨
    - æ›´æ–°è³‡æ–™åº« status = ENDED
                </pre>

                <h3>ğŸ”§ Docker Compose è¨­å®šæª”ç¯„ä¾‹</h3>
                <pre class="code-block">version: '3.8'

services:
  srs:
    image: ossrs/srs:5
    ports:
      - "1935:1935"
      - "1985:1985"
    environment:
      - SRS_HTTP_API_ENABLED=on
      - SRS_HTTP_HOOKS_ENABLED=on
    networks:
      - myanstream

  laravel:
    build: ./laravel
    ports:
      - "8000:8000"
    environment:
      - APP_ENV=production
      - DB_HOST=mysql
    volumes:
      - ./laravel:/var/www/html
    networks:
      - myanstream

  worker:
    build: ./laravel
    command: php artisan queue:work
    volumes:
      - ./laravel:/var/www/html
      - /var/run/docker.sock:/var/run/docker.sock
    networks:
      - myanstream

  mysql:
    image: mysql:8.0
    environment:
      - MYSQL_DATABASE=myanstream
    volumes:
      - mysql_data:/var/lib/mysql
    networks:
      - myanstream

  redis:
    image: redis:7-alpine
    networks:
      - myanstream

networks:
  myanstream:

volumes:
  mysql_data:
                </pre>

                <h3>âš™ï¸ é—œéµè¨­è¨ˆåŸå‰‡</h3>
                <div class="success-box">
                    <h4>âœ… FFmpeg ä¸è¦è·Ÿ Octane Request ç¶ä¸€èµ·</h4>
                    <ul>
                        <li><strong>éŒ¯èª¤åšæ³•ï¼š</strong>åœ¨ Webhook Handler å…§ç›´æ¥å•Ÿå‹• FFmpeg ä¸¦ç­‰å¾… (æœƒé˜»å¡ HTTP å›æ‡‰)</li>
                        <li><strong>æ­£ç¢ºåšæ³•ï¼š</strong>Webhook Handler å¿«é€Ÿé©—è­‰ â†’ ä¸Ÿ Job â†’ ç«‹å³å›å‚³ 200 OK</li>
                        <li><strong>ç¨ç«‹ Workerï¼š</strong>ç”¨ç¨ç«‹çš„ Queue Worker æˆ–ç¨ç«‹å®¹å™¨è™•ç† FFmpeg å•Ÿå‹•</li>
                        <li><strong>ç‹€æ…‹è¿½è¹¤ï¼š</strong>æ‰€æœ‰å®¹å™¨ IDã€PID éƒ½å¯«å…¥è³‡æ–™åº«/Redis</li>
                    </ul>
                </div>

                <div class="warning-box">
                    <h4>âš ï¸ è‡ªæ¶ç‰ˆæœ¬çš„é™åˆ¶</h4>
                    <ul>
                        <li><strong>å–®é»æ•…éšœï¼š</strong>ä¸»æ©Ÿæ›æ‰ï¼Œæ‰€æœ‰ç›´æ’­ä¸­æ–·</li>
                        <li><strong>æ“´å……æ€§æœ‰é™ï¼š</strong>å‚ç›´æ“´å……å—é™æ–¼å–®æ©Ÿç¡¬é«”</li>
                        <li><strong>éœ€è¦æ‰‹å‹•ç¶­è­·ï¼š</strong>ç³»çµ±æ›´æ–°ã€å‚™ä»½ã€ç›£æ§éƒ½éœ€è‡ªè¡Œè™•ç†</li>
                        <li><strong>é »å¯¬æˆæœ¬ï¼š</strong>å¤§é‡ä¸¦ç™¼æ™‚é »å¯¬æˆæœ¬å¯èƒ½å¾ˆé«˜</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- AWS ECS Tab -->
        <div id="ecs" class="tab-content">
            <div class="diagram-section">
                <h2>â˜ï¸ AWS ECS é›²ç«¯ç‰ˆæœ¬æ¶æ§‹</h2>

                <div class="info-box">
                    <h4>ğŸš€ é©åˆå ´æ™¯</h4>
                    <ul>
                        <li><strong>ç”Ÿç”¢ç’°å¢ƒï¼š</strong>éœ€è¦é«˜å¯ç”¨æ€§èˆ‡è‡ªå‹•å®¹éŒ¯ç§»è½‰</li>
                        <li><strong>å¤§è¦æ¨¡ï¼š</strong>åŒæ™‚åœ¨ç·šç›´æ’­æ•¸ > 50 å ´</li>
                        <li><strong>å½ˆæ€§æ“´å……ï¼š</strong>æµé‡æ³¢å‹•å¤§ï¼Œéœ€è¦è‡ªå‹•æ“´å……ç¸®æ¸›</li>
                        <li><strong>å…¨çƒæœå‹™ï¼š</strong>éœ€è¦å¤šå€åŸŸéƒ¨ç½²</li>
                    </ul>
                </div>

                <h3>ğŸ—ï¸ ECS éƒ¨ç½²æ¶æ§‹</h3>
                <pre class="mermaid">
graph TB
    subgraph client["ğŸ“± å®¢æˆ¶ç«¯"]
        A[ä½¿ç”¨è€… App]
    end

    subgraph lb["âš–ï¸ AWS è² è¼‰å¹³è¡¡å™¨"]
        B[NLB<br/>Network Load Balancer<br/>TCP 1935]
        C[ALB<br/>Application Load Balancer<br/>HTTP/S]
    end

    subgraph ecs["â˜ï¸ AWS ECS Fargate"]
        D[SRS Service<br/>1-3 Tasks<br/>2 vCPU / 4GB]
        E[Laravel Octane Service<br/>2-10 Tasks Auto Scale<br/>1 vCPU / 2GB]
        F[FFmpeg Task 1<br/>æŒ‰éœ€å•Ÿå‹•<br/>2 vCPU / 4GB]
        G[FFmpeg Task 2<br/>æŒ‰éœ€å•Ÿå‹•<br/>2 vCPU / 4GB]
    end

    subgraph aws["ğŸ—„ï¸ AWS è¨—ç®¡æœå‹™"]
        H[(RDS MySQL)]
        I[(ElastiCache Redis)]
    end

    subgraph platforms["ğŸŒ ç›´æ’­å¹³å°"]
        J[YouTube Live]
        K[Facebook Live]
    end

    A -->|RTMP| B
    A -->|HTTPS| C
    B --> D
    C --> E
    E -.->|RunTask| F
    E -.->|RunTask| G
    D -.->|Webhook| E
    D -.->|æ‹‰æµ| F
    D -.->|æ‹‰æµ| G
    E --> H
    E --> I
    F -->|RTMPS| J
    G -->|RTMPS| K

    classDef clientStyle fill:#bbdefb,stroke:#1976d2,stroke-width:2px
    classDef lbStyle fill:#fff9c4,stroke:#f57c00,stroke-width:2px
    classDef ecsStyle fill:#c8e6c9,stroke:#388e3c,stroke-width:2px
    classDef awsStyle fill:#e1bee7,stroke:#7b1fa2,stroke-width:2px
    classDef platformStyle fill:#ffccbc,stroke:#d84315,stroke-width:2px

    class A clientStyle
    class B,C lbStyle
    class D,E,F,G ecsStyle
    class H,I awsStyle
    class J,K platformStyle
                </pre>

                <h3>ğŸ“‹ ECS çµ„ä»¶é…ç½®</h3>
                <table>
                    <thead>
                        <tr>
                            <th>çµ„ä»¶</th>
                            <th>é¡å‹</th>
                            <th>åŸ·è¡Œå€‹é«”æ•¸</th>
                            <th>CPU/RAM</th>
                            <th>è² è¼‰å¹³è¡¡å™¨</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>SRS Server</strong></td>
                            <td>ECS Service</td>
                            <td>1-3 (å›ºå®š)</td>
                            <td>2048 / 4GB</td>
                            <td>NLB (TCP)</td>
                        </tr>
                        <tr>
                            <td><strong>Laravel Octane</strong></td>
                            <td>ECS Service</td>
                            <td>2-10 (Auto Scale)</td>
                            <td>1024 / 2GB</td>
                            <td>ALB (HTTP/S)</td>
                        </tr>
                        <tr>
                            <td><strong>FFmpeg</strong></td>
                            <td>ECS Task (æŒ‰éœ€)</td>
                            <td>å‹•æ…‹ (æ¯å ´ç›´æ’­ 1 å€‹)</td>
                            <td>2048 / 4GB</td>
                            <td>ç„¡</td>
                        </tr>
                    </tbody>
                </table>

                <h3>ğŸ”’ Security Groups è¨­å®š</h3>
                <pre class="code-block">SG-SRS (SRS Tasks):
  Inbound:  é€£æ¥åŸ  1935 from NLB
            é€£æ¥åŸ  1935 from SG-FFmpeg
            é€£æ¥åŸ  1985 from SG-Laravel
  Outbound: é€£æ¥åŸ  8000 to SG-Laravel

SG-Laravel (Laravel Tasks):
  Inbound:  é€£æ¥åŸ  8000 from ALB
            é€£æ¥åŸ  8000 from SG-SRS
  Outbound: é€£æ¥åŸ  443 to 0.0.0.0/0
            é€£æ¥åŸ  3306 to SG-RDS
            é€£æ¥åŸ  6379 to SG-Redis

SG-FFmpeg (FFmpeg Tasks):
  Inbound:  ç„¡
  Outbound: é€£æ¥åŸ  1935 to SG-SRS
            é€£æ¥åŸ  443 to 0.0.0.0/0
                </pre>

                <h3>ğŸ“ˆ Auto Scaling ç­–ç•¥</h3>
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4>Laravel Octane</h4>
                        <p><strong>æŒ‡æ¨™ï¼š</strong>CPU ä½¿ç”¨ç‡</p>
                        <p><strong>ç›®æ¨™å€¼ï¼š</strong>70%</p>
                        <p><strong>ç¯„åœï¼š</strong>2-10 Tasks</p>
                    </div>

                    <div class="feature-card">
                        <h4>SRS Server</h4>
                        <p><strong>ç­–ç•¥ï¼š</strong>å›ºå®šæ•¸é‡ï¼Œä¸å»ºè­° Auto Scaling</p>
                        <p><strong>åŸå› ï¼š</strong>é¿å…æ¨æµä¸­æ–·</p>
                    </div>

                    <div class="feature-card">
                        <h4>FFmpeg Tasks</h4>
                        <p><strong>ç­–ç•¥ï¼š</strong>æŒ‰éœ€å•Ÿå‹• (RunTask)</p>
                        <p><strong>æ•¸é‡ï¼š</strong>= ç•¶å‰ç›´æ’­å ´æ¬¡</p>
                    </div>
                </div>

                <div class="warning-box">
                    <h4>âš ï¸ é‡è¦ï¼šSRS çš„ Sticky Session å•é¡Œ</h4>
                    <ul>
                        <li><strong>å•é¡Œï¼š</strong>RTMP æ˜¯æœ‰ç‹€æ…‹é€£ç·šï¼Œæ¨æµéç¨‹ä¸èƒ½åˆ‡æ›å¾Œç«¯ SRS åŸ·è¡Œå€‹é«”</li>
                        <li><strong>è§£æ±ºæ–¹æ¡ˆ Aï¼š</strong>NLB + Source IP Hash (åŒä¸€ IP è·¯ç”±åˆ°åŒä¸€ SRS)</li>
                        <li><strong>è§£æ±ºæ–¹æ¡ˆ Bï¼š</strong>æ¯å€‹ Stream ç¶å®šç‰¹å®š SRS ç¯€é»</li>
                        <li><strong>è§£æ±ºæ–¹æ¡ˆ Cï¼š</strong>å–®ä¸€ SRS + å¤šå€‹ FFmpeg ç¯€é» (å»ºè­°åˆæœŸä½¿ç”¨)</li>
                    </ul>
                </div>

                <h3>ğŸ’° æˆæœ¬æœ€ä½³åŒ–å»ºè­°</h3>
                <div class="success-box">
                    <h4>ğŸ’¡ ä½¿ç”¨ Fargate Spot ç¯€çœ 70% æˆæœ¬</h4>
                    <ul>
                        <li><strong>é©ç”¨æ–¼ï¼š</strong>FFmpeg Tasks (å¯å®¹å¿å¶çˆ¾ä¸­æ–·)</li>
                        <li><strong>ä¸é©ç”¨æ–¼ï¼š</strong>SRS å’Œ Laravel (éœ€è¦ç©©å®šé‹è¡Œ)</li>
                        <li><strong>è¨­å®šæ–¹å¼ï¼š</strong>åœ¨ RunTask API æŒ‡å®š FARGATE_SPOT capacity provider</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- å®Œæ•´æµç¨‹ Tab -->
        <div id="flow" class="tab-content">
            <div class="diagram-section">
                <h2>ğŸ”„ å®Œæ•´ç›´æ’­æµç¨‹æ™‚åºåœ–</h2>

                <h3>Phase 1: ç›´æ’­æº–å‚™éšæ®µ</h3>
                <pre class="mermaid">
sequenceDiagram
    participant App
    participant Laravel
    participant YT as YouTube
    participant FB as Facebook
    participant DB

    App->>Laravel: POST /api/streams/create
    Laravel->>YT: Create Broadcast
    YT-->>Laravel: ingest_url + key
    Laravel->>FB: Create Live Video
    FB-->>Laravel: ingest_url + key
    Laravel->>DB: Save Session
    Laravel-->>App: rtmp_url + stream_key
                </pre>

                <h3>Phase 2: æ¨æµå•Ÿå‹•éšæ®µ</h3>
                <pre class="mermaid">
sequenceDiagram
    participant App
    participant SRS
    participant Laravel
    participant Worker
    participant FFmpeg

    App->>SRS: Push RTMP stream
    SRS->>Laravel: Webhook: on_publish
    Laravel->>Laravel: Verify + Update status
    Laravel->>Worker: dispatch Job
    Laravel-->>SRS: 200 OK
    Worker->>FFmpeg: Start FFmpeg
    FFmpeg->>SRS: Pull stream from SRS
    FFmpeg->>Platforms: Push to platforms
                </pre>

                <h3>Phase 3: ç›´æ’­çµæŸéšæ®µ</h3>
                <pre class="mermaid">
sequenceDiagram
    participant App
    participant SRS
    participant Laravel
    participant FFmpeg
    participant DB

    App->>SRS: Stop streaming
    SRS->>Laravel: Webhook: on_unpublish
    Laravel->>FFmpeg: Stop FFmpeg
    Laravel->>DB: Update status=ENDED
    Laravel-->>App: StreamEndedEvent
                </pre>
            </div>
        </div>

        <!-- è³‡æ–™åº«è¨­è¨ˆ Tab -->
        <div id="database" class="tab-content">
            <div class="diagram-section">
                <h2>ğŸ’¾ è³‡æ–™åº«è¨­è¨ˆ</h2>

                <h3>ğŸ“‹ live_sessions è¡¨</h3>
                <table>
                    <thead>
                        <tr>
                            <th>æ¬„ä½åç¨±</th>
                            <th>å‹åˆ¥</th>
                            <th>èªªæ˜</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>id</code></td>
                            <td>BIGINT PK</td>
                            <td>ä¸»éµ</td>
                        </tr>
                        <tr>
                            <td><code>internal_stream_key</code></td>
                            <td>VARCHAR(100) UNIQUE</td>
                            <td>å…§éƒ¨ stream keyï¼Œå¦‚ï¼šuser123_abc456</td>
                        </tr>
                        <tr>
                            <td><code>user_id</code></td>
                            <td>BIGINT</td>
                            <td>é—œè¯åˆ° users è¡¨</td>
                        </tr>
                        <tr>
                            <td><code>youtube_ingest_url</code></td>
                            <td>TEXT</td>
                            <td>YouTube RTMPS URL</td>
                        </tr>
                        <tr>
                            <td><code>youtube_stream_key</code></td>
                            <td>VARCHAR(255)</td>
                            <td>YouTube stream key</td>
                        </tr>
                        <tr>
                            <td><code>facebook_ingest_url</code></td>
                            <td>TEXT</td>
                            <td>Facebook RTMPS URL</td>
                        </tr>
                        <tr>
                            <td><code>facebook_stream_key</code></td>
                            <td>VARCHAR(255)</td>
                            <td>Facebook stream key</td>
                        </tr>
                        <tr>
                            <td><code>status</code></td>
                            <td>ENUM</td>
                            <td>READY / STARTING / PUBLISHING / ENDED / FAILED</td>
                        </tr>
                        <tr>
                            <td><code>ffmpeg_container_id</code></td>
                            <td>VARCHAR(255)</td>
                            <td>FFmpeg å®¹å™¨ ID (Docker) æˆ– Task ARN (ECS)</td>
                        </tr>
                        <tr>
                            <td><code>started_at</code></td>
                            <td>TIMESTAMP</td>
                            <td>ç›´æ’­é–‹å§‹æ™‚é–“</td>
                        </tr>
                        <tr>
                            <td><code>ended_at</code></td>
                            <td>TIMESTAMP</td>
                            <td>ç›´æ’­çµæŸæ™‚é–“</td>
                        </tr>
                    </tbody>
                </table>

                <h3>ğŸ”‘ ç´¢å¼•è¨­è¨ˆ</h3>
                <pre class="code-block">CREATE INDEX idx_stream_key ON live_sessions(internal_stream_key);
CREATE INDEX idx_user_status ON live_sessions(user_id, status);
CREATE INDEX idx_started_at ON live_sessions(started_at);
                </pre>

                <h3>ğŸ“Š ç‹€æ…‹æµè½‰åœ–</h3>
                <pre class="mermaid">
stateDiagram-v2
    [*] --> READY
    READY --> STARTING: on_publish
    STARTING --> PUBLISHING: FFmpeg started
    STARTING --> FAILED: Start failed
    PUBLISHING --> ENDED: on_unpublish
    PUBLISHING --> FAILED: Error
    ENDED --> [*]
    FAILED --> [*]
                </pre>
            </div>
        </div>

        <!-- æ–¹æ¡ˆæ¯”è¼ƒ Tab -->
        <div id="comparison" class="tab-content">
            <div class="diagram-section">
                <h2>âš–ï¸ è‡ªæ¶ vs ECS æ–¹æ¡ˆæ¯”è¼ƒ</h2>

                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>æ¯”è¼ƒé …ç›®</th>
                            <th>è‡ªæ¶ Docker ç‰ˆæœ¬</th>
                            <th>AWS ECS ç‰ˆæœ¬</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>åˆæœŸæˆæœ¬</strong></td>
                            <td><span class="pros">âœ“ ä½</span><br/>VPS $20-100/æœˆ</td>
                            <td><span class="cons">âœ— è¼ƒé«˜</span><br/>$200-500/æœˆèµ·</td>
                        </tr>
                        <tr>
                            <td><strong>æ“´å……æ€§</strong></td>
                            <td><span class="cons">âœ— æœ‰é™</span><br/>å—å–®æ©Ÿç¡¬é«”é™åˆ¶</td>
                            <td><span class="pros">âœ“ å„ªç•°</span><br/>è‡ªå‹•æ“´å……ç¸®æ¸›</td>
                        </tr>
                        <tr>
                            <td><strong>é«˜å¯ç”¨æ€§</strong></td>
                            <td><span class="cons">âœ— å–®é»æ•…éšœ</span><br/>éœ€è‡ªè¡Œè¨­å®šå‚™æ´</td>
                            <td><span class="pros">âœ“ å…§å»º</span><br/>è‡ªå‹•å®¹éŒ¯ç§»è½‰</td>
                        </tr>
                        <tr>
                            <td><strong>ç¶­è­·æˆæœ¬</strong></td>
                            <td><span class="cons">âœ— é«˜</span><br/>éœ€æ‰‹å‹•æ›´æ–°ç¶­è­·</td>
                            <td><span class="pros">âœ“ ä½</span><br/>AWS ç®¡ç†åŸºç¤è¨­æ–½</td>
                        </tr>
                        <tr>
                            <td><strong>å­¸ç¿’æ›²ç·š</strong></td>
                            <td><span class="pros">âœ“ ç°¡å–®</span><br/>Docker Compose å³å¯</td>
                            <td><span class="cons">âœ— è¤‡é›œ</span><br/>éœ€äº†è§£ AWS æœå‹™</td>
                        </tr>
                        <tr>
                            <td><strong>ç›£æ§å‘Šè­¦</strong></td>
                            <td><span class="cons">âœ— éœ€è‡ªå»º</span><br/>éœ€æ•´åˆç¬¬ä¸‰æ–¹å·¥å…·</td>
                            <td><span class="pros">âœ“ å®Œæ•´</span><br/>CloudWatch å…§å»º</td>
                        </tr>
                        <tr>
                            <td><strong>é©åˆè¦æ¨¡</strong></td>
                            <td>< 50 å ´åŒæ™‚åœ¨ç·š</td>
                            <td>> 50 å ´åŒæ™‚åœ¨ç·š</td>
                        </tr>
                    </tbody>
                </table>

                <h3>ğŸ’¡ å»ºè­°ç­–ç•¥</h3>
                <div class="feature-grid">
                    <div class="feature-card">
                        <h4>ğŸ åˆæœŸéšæ®µ (MVP)</h4>
                        <ul>
                            <li><strong>é¸æ“‡ï¼š</strong>è‡ªæ¶ Docker ç‰ˆæœ¬</li>
                            <li><strong>åŸå› ï¼š</strong>å¿«é€Ÿé©—è­‰åŠŸèƒ½ï¼Œæˆæœ¬ä½</li>
                            <li><strong>ä¸»æ©Ÿï¼š</strong>Linode/DigitalOcean $40/æœˆ</li>
                            <li><strong>è¦æ ¼ï¼š</strong>4 Core / 8GB RAM</li>
                        </ul>
                    </div>

                    <div class="feature-card">
                        <h4>ğŸ“ˆ æˆé•·éšæ®µ</h4>
                        <ul>
                            <li><strong>é¸æ“‡ï¼š</strong>æ··åˆæ¶æ§‹</li>
                            <li><strong>ç­–ç•¥ï¼š</strong>SRS/Laravel è‡ªæ¶ï¼ŒFFmpeg ç”¨ ECS Fargate Spot</li>
                            <li><strong>åŸå› ï¼š</strong>å¹³è¡¡æˆæœ¬èˆ‡æ“´å……æ€§</li>
                        </ul>
                    </div>

                    <div class="feature-card">
                        <h4>ğŸš€ æˆç†Ÿéšæ®µ</h4>
                        <ul>
                            <li><strong>é¸æ“‡ï¼š</strong>å®Œæ•´ AWS ECS</li>
                            <li><strong>åŸå› ï¼š</strong>éœ€è¦é«˜å¯ç”¨æ€§èˆ‡å…¨çƒéƒ¨ç½²</li>
                            <li><strong>æ­é…ï¼š</strong>å¤šå€åŸŸ + CDN</li>
                        </ul>
                    </div>
                </div>

                <h3>ğŸ’° æˆæœ¬ä¼°ç®— (æ¯æœˆ)</h3>
                <table>
                    <thead>
                        <tr>
                            <th>é …ç›®</th>
                            <th>è‡ªæ¶ Docker</th>
                            <th>AWS ECS</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>ä¸»æ©Ÿ/é‹ç®—</td>
                            <td>$40</td>
                            <td>$200-500</td>
                        </tr>
                        <tr>
                            <td>è³‡æ–™åº«</td>
                            <td>$0 (è‡ªæ¶)</td>
                            <td>$50-150 (RDS)</td>
                        </tr>
                        <tr>
                            <td>å¿«å–</td>
                            <td>$0 (è‡ªæ¶)</td>
                            <td>$30-80 (ElastiCache)</td>
                        </tr>
                        <tr>
                            <td>è² è¼‰å¹³è¡¡</td>
                            <td>$0 (Nginx)</td>
                            <td>$20-40 (ALB/NLB)</td>
                        </tr>
                        <tr>
                            <td>é »å¯¬</td>
                            <td>$20-100</td>
                            <td>$50-200</td>
                        </tr>
                        <tr>
                            <td><strong>ç¸½è¨ˆ</strong></td>
                            <td><strong>$60-140</strong></td>
                            <td><strong>$350-970</strong></td>
                        </tr>
                    </tbody>
                </table>

                <div class="info-box">
                    <h4>ğŸ“ å‚™è¨»</h4>
                    <ul>
                        <li>ä»¥ä¸Šæˆæœ¬ç‚ºæ¯æœˆ 20-50 å ´ä¸¦ç™¼ç›´æ’­çš„ä¼°ç®—</li>
                        <li>å¯¦éš›æˆæœ¬ä¾ä½¿ç”¨é‡ã€å€åŸŸã€æµé‡è€Œç•°</li>
                        <li>ECS ä½¿ç”¨ Fargate Spot å¯ç¯€çœ 50-70% é‹ç®—æˆæœ¬</li>
                        <li>å¹³å° API å‘¼å«è²»ç”¨æœªè¨ˆå…¥ (é€šå¸¸å…è²»æˆ–æ¥µä½)</li>
                    </ul>
                </div>
            </div>
        </div>

        <footer>
            <p><strong>ğŸ“ myanStream æ¶æ§‹æ–‡ä»¶</strong></p>
            <p>ç‰ˆæœ¬: 1.0.0 | æœ€å¾Œæ›´æ–°: <span id="lastUpdate"></span></p>
            <p><a href="../index.html" style="color: #667eea; text-decoration: none;">è¿”å›å°ˆæ¡ˆåˆ—è¡¨ â†’</a></p>
        </footer>
    </div>

    <script>
        // è¨­å®š Mermaid é…ç½®ï¼ˆæ”¹ç‚ºæ‰‹å‹•å•Ÿå‹•ï¼‰
        mermaid.initialize({
            startOnLoad: false,
            theme: 'default',
            securityLevel: 'loose',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true
            }
        });

        // Tab åˆ‡æ›å‡½æ•¸
        function showTab(tabName, tabButton) {
            const contents = document.querySelectorAll('.tab-content');
            contents.forEach(content => {
                content.classList.remove('active');
            });

            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.classList.remove('active');
            });

            document.getElementById(tabName).classList.add('active');
            if (tabButton) {
                tabButton.classList.add('active');
            }

            // å¼·åˆ¶é‡æ–°æ¸²æŸ“ Mermaid åœ–è¡¨
            setTimeout(function() {
                mermaid.init(undefined, document.querySelectorAll('#' + tabName + ' .mermaid'));
            }, 100);
        }

        // é é¢è¼‰å…¥æ™‚åŸ·è¡Œ
        document.addEventListener('DOMContentLoaded', function() {
            // è¨­å®šæ—¥æœŸ
            document.getElementById('lastUpdate').textContent = new Date().toLocaleDateString('zh-TW');

            // åˆå§‹æ¸²æŸ“é è¨­ Tab çš„ Mermaid åœ–
            mermaid.init(undefined, document.querySelectorAll('#overview .mermaid'));

            // æ·¡å…¥å‹•ç•«
            const container = document.querySelector('.container');
            container.style.opacity = '0';
            container.style.transform = 'translateY(20px)';

            setTimeout(() => {
                container.style.transition = 'all 0.6s ease';
                container.style.opacity = '1';
                container.style.transform = 'translateY(0)';
            }, 100);
        });
    </script>
</body>
</html>
